<%= form_with model: book, class: "space-y-4", data: { controller: "character-count" } do |f| %>
  <% if book.errors.any? %>
    <div class="bg-accent-danger/10 border border-accent-danger/20 rounded-lg p-4 mb-4">
      <div class="flex items-center gap-2 text-accent-danger mb-2">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span class="font-medium">入力エラー</span>
      </div>
      <ul class="list-disc list-inside text-sm text-accent-danger space-y-1">
        <% book.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :title, class: "form-label" %>
    <%= f.text_field :title, class: "form-input", placeholder: "本のタイトル" %>
  </div>

  <div class="form-group">
    <%= f.label :body, "感想", class: "form-label" %>
    <div class="relative">
      <%= f.text_area :body,
                      class: "form-textarea",
                      placeholder: "この本の感想を書いてください...",
                      rows: 4,
                      maxlength: 2000,
                      data: { character_count_target: "input", action: "input->character-count#update" } %>
      <div class="absolute bottom-2 right-2 text-xs text-muted">
        <span data-character-count-target="count"><%= book.body&.length || 0 %></span>/2000
      </div>
    </div>
  </div>

  <div class="form-group">
    <%= f.label :tag_list, "タグ", class: "form-label" %>
    <%= f.text_field :tag_list,
                     class: "form-input",
                     placeholder: "小説, ビジネス, SF（カンマ区切り）",
                     value: book.tag_list %>
    <p class="text-xs text-muted mt-1">カンマ（,）区切りで複数入力できます</p>
  </div>

  <div class="form-group">
    <%= f.label :image, "表紙画像", class: "form-label" %>
    <div class="mt-1 flex items-center gap-4">
      <% if book.image.attached? %>
        <%= image_tag book.image, class: "h-20 w-14 object-cover rounded" %>
      <% end %>
      <%= f.file_field :image,
                       accept: "image/*",
                       class: "block w-full text-sm text-secondary
                               file:mr-4 file:py-2 file:px-4
                               file:rounded-lg file:border-0
                               file:text-sm file:font-medium
                               file:bg-bg-tertiary file:text-primary
                               hover:file:bg-border-color
                               cursor-pointer" %>
    </div>
  </div>

  <div class="pt-2">
    <%= f.submit book.persisted? ? "更新する" : "投稿する", class: "btn-primary w-full" %>
  </div>
<% end %>
